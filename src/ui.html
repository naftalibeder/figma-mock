<style type="text/css">
  textarea {
    resize: none;
    width: 100%;
  }
  div {
    font-size: 11;
  }
  button {
    font-size: 11;
  }
</style>

<body>
  <link rel="stylesheet" href="main.css" />

  <div>Enter text to paste into the selected components, separated by new lines.</div>
  <textarea id="list" rows="5" placeholder="Milk\nEggs\nButter"></textarea>
  <div id="options" style="display: block;"></div>
  <button id="confirm">Replace elements</button>
  <button id="cancel">Cancel</button>
</body>

<script>
  const list = document.getElementById('list');
  list.placeholder = list.placeholder.replace(/\\n/g, '\n');

  onmessage = event => {
    const msg = event.data.pluginMessage;
    const container = document.getElementById('options');
    const confirmButton = document.getElementById('confirm');

    if (msg.type === 'init') {
      confirmButton.disabled = true;

      const uniqueKinds = msg.uniqueKinds;

      uniqueKinds.forEach(kind => {
        const optionContainer = document.createElement('div');
        container.appendChild(optionContainer);

        const radioInput = document.createElement('input');
        radioInput.type = 'radio';
        radioInput.name = 'optionInput';
        radioInput.value = kind.nodeName;
        radioInput.count = kind.count;
        radioInput.onchange = ({ target }) => {
          confirmButton.disabled = false;
          confirmButton.innerHTML = `Replace ${target.count} elements`;
        };
        optionContainer.appendChild(radioInput);

        const nameLabel = document.createElement('label');
        nameLabel.innerHTML = kind.nodeName;
        optionContainer.appendChild(nameLabel);

        const countLabel = document.createElement('label');
        countLabel.style = "margin-left: 10;";
        countLabel.innerHTML = kind.count;
        optionContainer.appendChild(countLabel);
      })
    }
  };

  document.getElementById('confirm').onclick = () => {
    const listInput = document.getElementById('list');
    const listText = listInput.value;

    const options = [...document.getElementsByName('optionInput')];
    const selected = options.filter(field => field.checked)[0];
    const selectionText = selected.value;

    parent.postMessage({ pluginMessage: { type: 'confirm', listText, selectionText } }, '*');
  };

  document.getElementById('cancel').onclick = () => {
    parent.postMessage({ pluginMessage: { type: 'cancel' } }, '*');
  };

  parent.postMessage({ pluginMessage: { type: 'init' } }, '*');
</script>